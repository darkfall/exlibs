// ======================================================================================
// File         : TimerMng.h
// Author       : Wu Jie 
// Last Change  : 03/26/2010 | 19:20:14 PM | Friday,March
// Description  : 
// ======================================================================================

// #################################################################################
#ifndef TIMERMNG_H_1269602416
#define TIMERMNG_H_1269602416
// #################################################################################

// ######################### 
namespace ex { 
// ######################### 

///////////////////////////////////////////////////////////////////////////////
// class TimerMng 
// 
// Purpose: 
// 
///////////////////////////////////////////////////////////////////////////////

class EX_LIBS_DLL TimerMng
{
    ///////////////////////////////////////////////////////////////////////////////
    // singleton decl
    ///////////////////////////////////////////////////////////////////////////////

    EX_DECL_SINGLETON ( TimerMng );
    friend class Timer;
    typedef Array<Timer*> timers_t;
    typedef List<Timer*> timer_list_t;

    ///////////////////////////////////////////////////////////////////////////////
    // public member functions
    ///////////////////////////////////////////////////////////////////////////////

public:

    TimerMng ();
    ~TimerMng ();

    void tick ();

    timer_t* createTimer ( const timespan_t& _interval = 0, timer_t::timeout_callback_t _callback = timer_t::timeout_callback_t() );
    void deleteTimer ( timer_t* _pTimer );

    ///////////////////////////////////////////////////////////////////////////////
    // protected member functions
    ///////////////////////////////////////////////////////////////////////////////

protected:

    void addTimer ( timer_t* _pTimer );
    void removeTimer ( timer_t* _pTimer );
    void processDelete ( timer_t* _pTimer );

    ///////////////////////////////////////////////////////////////////////////////
    // protected member data
    ///////////////////////////////////////////////////////////////////////////////

protected:

    timers_t m_timers;
    timer_list_t m_freeTimers;

}; // end class TimerMng


// ######################### 
} // end namespace ex 
// ######################### 


// #################################################################################
#endif // END TIMERMNG_H_1269602416
// #################################################################################



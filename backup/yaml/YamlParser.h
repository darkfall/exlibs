// ======================================================================================
// File         : YamlParser.h
// Author       : Wu Jie 
// Last Change  : 10/01/2009 | 12:24:21 PM | Thursday,October
// Description  : 
// ======================================================================================

// #################################################################################
#ifndef YAMLPARSER_H_1254313940
#define YAMLPARSER_H_1254313940
// #################################################################################

///////////////////////////////////////////////////////////////////////////////
// includes
///////////////////////////////////////////////////////////////////////////////

#include "YamlNode.h"

// ######################### 
namespace ex { 
// ######################### 

///////////////////////////////////////////////////////////////////////////////
// class CYamlParser 
// 
// Purpose: 
// 
///////////////////////////////////////////////////////////////////////////////

class EX_LIBS_DLL CYamlParser
{
    typedef CYamlParser self_t;
    typedef TStack<CYamlNode::smart_ptr_t> node_stack_t;

    ///////////////////////////////////////////////////////////////////////////////
    // typedefs
    ///////////////////////////////////////////////////////////////////////////////

public:

    typedef Array<CYamlNode::smart_ptr_t> yaml_documents_t; 
    typedef HashMap<string_t,CYamlNode::smart_ptr_t> alias_to_node_t; 

    ///////////////////////////////////////////////////////////////////////////////
    // constructor & destructor
    ///////////////////////////////////////////////////////////////////////////////

public:

    CYamlParser ();
    ~CYamlParser ();

    ///////////////////////////////////////////////////////////////////////////////
    // public member functions 
    ///////////////////////////////////////////////////////////////////////////////

public:

    //
    void Parse( const uint8* _pBuffer, uint _size );
    void ParseFile( const char* _filename );

    //
    const yaml_documents_t& GetDocuments () const { return m_Documents; }

    ///////////////////////////////////////////////////////////////////////////////
    // protected member functions
    ///////////////////////////////////////////////////////////////////////////////

public:

    bool ProcessEvent( const yaml_event_t& _event );

    ///////////////////////////////////////////////////////////////////////////////
    // protected member data
    ///////////////////////////////////////////////////////////////////////////////

protected:

    yaml_parser_t       m_Parser;
    yaml_documents_t    m_Documents;
    node_stack_t        m_ProcessingNodeStack;
    alias_to_node_t     m_AliasToNode;

}; // end class CYamlParser

// ######################### 
} // end namespace ex 
// ######################### 


// #################################################################################
#endif // END YAMLPARSER_H_1254313940
// #################################################################################
